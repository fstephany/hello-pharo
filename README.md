# HelloPharo

## Goal of the project

HelloPharo is a small code farm that creates a basic project architecture
for easy deployment.

This code farm is a starting point. We expect you to tweak the configuration to
fit your need, we just provide sensible default.

A developer should not have to think too much about the deployment and configuration
details when he starts to develop a service on the web with pharo.

One of the secret goal of HelloPharo is to provide a stack of tools to implement a
[Twelve-factor app](http://12factor.net/).

## Usage

### Server setup

HelloPharo is developed and tested against virtual machines in Azure.

### Quick

In a nutshell:

* Create an Azure Ubuntu VM
* Log to it using the username/password given in the administration panel
* Create a user with which you want to deploy (e.g., `deploy`)
* Make this user sudoable (so you can install packages)
* Add your SSH public key in `~/.ssh/authorized_keys` on the server for the deploy user.
* Edit the `vars.yml` file in the ansible directory to match yout setup
* Move to the ansible directory and launch server setup: `$ ansible-playbook -i hosts.ini server-setup.yml`
* Deploy your app with: `$ ansible-playbook -i hosts.ini deploy.yml`


### Details

`$ ansible-playbook -i hosts.ini server-setup.yml` will install git, nginx, pharo and
download the base Pharo3 images. You should run this script only at server startup.

Everytime you want to deploy the master branch of your app, run

    $ ansible-playbook -i hosts.ini deploy.yml


## Assets

The nginx configuration is made to load assets from the `assets/` folder.

## Known limitations

There's little chance that we overcome the following limitations:

- Suitable for single image application (no load balancing)
- Use git for versionning (even though your Smalltalk code can be hosted in
  a monticello repository)
- Only runs on Ubuntu Linux (using the Pharo PPA)

## To Do

- VM path detection for OSX/Linux
- Provide a default preference file (to have, at least, a common package-cache
  for all the images)
- symbolic link to `system` directory. It will contain assets generated by the app
  (e.g., the pictures uploaded by the users)
- Implement rollback
- Handling of production/staging environment
- Separate deploy user with the server-setup user. The deploy user does not need
  sudo root.
